---
keywords: fastai
description: unit test with pytest
title: Prevent Pytest truncate your error message
toc: true 
badges: true
comments: true
author: noklam
categories: ["python", "pytest", "great_expectations"]
nb_path: _notebooks/2021-03-17-Pytest-truncated-long-assertion-error.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-03-17-Pytest-truncated-long-assertion-error.ipynb
-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I am running test with <code>great_expectations</code> that validate data in UAT and production server with CI, so it would be nice if the log can capture this.</p>
<p>I created a custom error class that would do the job, however, <code>pytest</code> truncated my <code>AssertionError</code> since it is quite long.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I am using pytest magic from <a href="https://github.com/akaihola/ipython_pytest">https://github.com/akaihola/ipython_pytest</a> which allow me to run pytest in a Jupyter notebook cell.</p>
<p>It is quite simple with a few tens of lines.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%writefile</span> ipython_pytest.py
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">IPython.core</span> <span class="kn">import</span> <span class="n">magic</span>
<span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">main</span> <span class="k">as</span> <span class="n">pytest_main</span>


<span class="n">TEST_MODULE_NAME</span> <span class="o">=</span> <span class="s1">&#39;_ipytesttmp&#39;</span>

<span class="k">def</span> <span class="nf">pytest</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">cell</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">root</span><span class="p">:</span>
        <span class="n">oldcwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="n">tests_module_path</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.py&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TEST_MODULE_NAME</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Path</span><span class="p">(</span><span class="n">tests_module_path</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;COLUMNS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;80&#39;</span>
            <span class="n">pytest_main</span><span class="p">(</span><span class="n">args</span> <span class="o">+</span> <span class="p">[</span><span class="n">tests_module_path</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">TEST_MODULE_NAME</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">TEST_MODULE_NAME</span><span class="p">]</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">oldcwd</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">load_ipython_extension</span><span class="p">(</span><span class="n">ipython</span><span class="p">):</span>
    <span class="n">magic</span><span class="o">.</span><span class="n">register_cell_magic</span><span class="p">(</span><span class="n">pytest</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing ipython_pytest.py
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># !pip install pytest</span>
<span class="o">%</span><span class="k">load_ext</span> ipython_pytest
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The ipython_pytest extension is already loaded. To reload it, use:
  %reload_ext ipython_pytest
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">pytest</span>

def test_long_assertion_error():
    x = &quot;placeholder&quot;
    expect = &quot;abcdefg\n&quot;*20 # Long string
    assert x == expect
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>============================= test session starts =============================
platform win32 -- Python 3.8.3, pytest-6.2.2, py-1.10.0, pluggy-0.13.1
rootdir: C:\Users\channo\AppData\Local\Temp\tmpohw9e_9w
collected 1 item

_ipytesttmp.py F                                                         [100%]

================================== FAILURES ===================================
__________________________ test_long_assertion_error __________________________

    def test_long_assertion_error():
        x = &#34;placeholder&#34;
        expect = &#34;abcdefg\n&#34;*20 # Long string
&gt;       assert x == expect
E       AssertionError: assert &#39;placeholder&#39; == &#39;abcdefg\nabc...fg\nabcdefg\n&#39;
E         + placeholder
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg...
E         
E         ...Full output truncated (15 lines hidden), use &#39;-vv&#39; to show

_ipytesttmp.py:5: AssertionError
=========================== short test summary info ===========================
FAILED _ipytesttmp.py::test_long_assertion_error - AssertionError: assert &#39;pl...
============================== 1 failed in 0.06s ==============================
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can see that pytest truncated my error with <code>...</code>
Here is how I solve ths issue</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">pytest</span> -vv

def test_long_assertion_error():
    x = &quot;placeholder&quot;
    expect = &quot;abcdefg\n&quot;*20 # Long string
    assert x == expect
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>============================= test session starts =============================
platform win32 -- Python 3.8.3, pytest-6.2.2, py-1.10.0, pluggy-0.13.1 -- c:\programdata\miniconda3\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\channo\AppData\Local\Temp\tmpyic4vcra
collecting ... collected 1 item

_ipytesttmp.py::test_long_assertion_error FAILED                         [100%]

================================== FAILURES ===================================
__________________________ test_long_assertion_error __________________________

    def test_long_assertion_error():
        x = &#34;placeholder&#34;
        expect = &#34;abcdefg\n&#34;*20 # Long string
&gt;       assert x == expect
E       AssertionError: assert &#39;placeholder&#39; == (&#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;\n &#39;abcdefg\n&#39;)
E         + placeholder
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg
E         - abcdefg

_ipytesttmp.py:5: AssertionError
=========================== short test summary info ===========================
FAILED _ipytesttmp.py::test_long_assertion_error - AssertionError: assert &#39;pl...
============================== 1 failed in 0.06s ==============================
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

